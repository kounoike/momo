# ZeroMQ を利用した外部プロセスへの画像フレーム送信

## 概要

ZeroMQ を利用することで、 Momo 自体が受信した映像を外部プロセスへ送信することができるようになります。

現在はプロトタイプのため、動作を保証できません。SDL機能とは排他的に利用することを想定しています。

## ZeroMQ コマンド引数

- --use-zmq
    - ZeroMQ 機能を使う場合は指定します

現状、Momo側がクライアント側として動くようになってます（要検討）。起動するとローカルホストのTCP/5567ポートに接続し、PUB側として振る舞います。

## メッセージ

PUB-SUBモデルなので、受信側は適宜トピックをSUBSCRIBEする必要があります。現在は以下の3種類のトピックでメッセージを送信しています。

- `track/add`: トラックが追加されたとき、トラックIDと共に送信されます
- `track/remove`: トラックが削除されたとき、トラックIDと共に送信されます
- `frame/<track_id>`: デコード後の画像フレームが送信されます。詳細は後述

## フレームメッセージ

- topic（`frame/<track_id>`）
- フレームカウント(32bit int, ビッグエンディアン)
- 画像幅(32bit int, ビッグエンディアン)
- 画像高さ(32bit int, ビッグエンディアン)
- フレームカウント(32bit int, ビッグエンディアン)
- 画素データ(点順次、RGB 24 bit/pixel)

## その他

受信されなかったフレームは積極的に捨てられるよう、HWM(High Water Mark)を1にしてあります（なので、`track/*`も捨てられる可能性がある）。

